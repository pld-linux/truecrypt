--- truecrypt-4.3a-source-code/Linux/Kernel/Dm-target.c	2008-04-14 09:49:01.201141303 +0200
+++ truecrypt-4.3a-source-code/Linux/Kernel/Dm-target.c	2008-04-14 09:48:24.000000000 +0200
@@ -399,7 +399,11 @@ static void dereference_bio_ctx (struct 
 	if (!atomic_dec_and_test (&bc->ref_count))
 		return;
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,23)
+	bio_endio (bc->orig_bio, bc->error);
+#else
 	bio_endio (bc->orig_bio, bc->orig_bio->bi_size, bc->error);
+#endif
 	mempool_free (bc, tc->bio_ctx_pool);
 }
 
@@ -680,7 +680,11 @@ int __init dm_truecrypt_init(void)
 		goto err;
 	}
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,23)
+	bio_ctx_cache = kmem_cache_create ("truecrypt-bioctx", sizeof (struct bio_ctx), 0, 0, NULL);
+#else
	bio_ctx_cache = kmem_cache_create ("truecrypt-bioctx", sizeof (struct bio_ctx), 0, 0, NULL, NULL);
+#endif
 	if (!bio_ctx_cache)
 	{
 		error ("kmem_cache_create failed");
